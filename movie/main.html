<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간편 성폭행 후기</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Diphylleia&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="main.css"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js "></script>

</head>
<script>
  let target_id=0
  $(document).ready(function(){
      console.log("시작")

      $.ajax({
        url:"https://api.themoviedb.org/3/movie/popular?api_key=10923b261ba94d897ac6b81148314a3f&page=1",
        data:{},
        type:"GET",
        success:function(json){
          $("#movie_list").html('')
          console.log(json.results)
          console.log(json)
          console.log(json.results.length)
          let movie_list=json.results
          console.log(movie_list)
          for(i=0;i<movie_list.length;i++){
            console.log("test: ",i)

            let card=
            `
              <div class="col" id="movie_list">
          <div class="card h-100">
            <img src="https://i.namu.wiki/i/X5dAOF6cJg6xtJUFNw7Y1xcH3GkfKUjXwsBMvcoQkEWYVL4SixBy5xlj4P1b-gb_6IxKVLElFFX9EVa_yWpYlw.webp" class="card-img-top" alt="...">
            <img src="${'https://image.tmdb.org/t/p/w500/'+movie_list[i].poster_path}" class="card-img-top" alt="...">

            <div class="card-body">
              <h5 class="card-title">${movie_list[i].original_title}</h5>
              <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
            </div>
            <a class="btn btn-danger" href="#" role="button" onclick="review(${movie_list[i].id})">리뷰보기</a>
            <div class="card-footer">
              <small class="text-body-secondary">Last updated 3 mins ago</small>
            </div>

          </div>
        </div>
            `

            $("#movie_list").append(card)
          }
        },
        error:function(err){
          
        }
      })
    })

    
</script>
<body>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

    <nav class="navbar bg-dark border-bottom border-body" data-bs-theme="dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">
            <img src="https://plus.unsplash.com/premium_photo-1671209795288-cdbcf73bb53e?w=800&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxmZWF0dXJlZC1waG90b3MtZmVlZHwxMHx8fGVufDB8fHx8fA%3D%3D" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
            간편 성폭행 후기
          </a>
    </nav>

    <div class="container">
      <div class="container-fluid bg-light p-5" id="jumbotron">
        <h1 class="display-4">성폭행 리뷰</h1>
        <p class="lead">This is  a jumbotron created using the bootstrap 5</p>
        <hr class="my-4">
        <p>It uses utility classes for typography and spacing to space content out within the larger container.</p>
        <a class="btn btn-danger" href="#" role="button">Learn more</a>
      </div>
      <div class="container_card">
        <div class="row row-cols-1 row-cols-md-3 g-4">
          <div class="col" id="movie_list">
            <div class="card h-100">
              <img src="https://i.namu.wiki/i/X5dAOF6cJg6xtJUFNw7Y1xcH3GkfKUjXwsBMvcoQkEWYVL4SixBy5xlj4P1b-gb_6IxKVLElFFX9EVa_yWpYlw.webp" class="card-img-top" alt="...">
              
              <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
              </div>
              <a class="btn btn-danger" href="#" role="button" onclick="review()">리뷰보기</a>
              <div class="card-footer">
                <small class="text-body-secondary">Last updated 3 mins ago</small>
              </div>
  
            </div>
          </div>
        </div>
      
        
        </div>

        <div class="modal" id="review-modal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">성폭행 후기</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>Modal body text goes here.</p>
              </div>
              <div class="modal-footer">
                <input type="text" class="form-control" id="review" style="width:65%"/>
                <button type="button" class="btn btn-primary" onclick="addReview()">성폭행 후기 쓰기</button>
              </div>
            </div>
          </div>
        </div>

        <script>
          function review(id){
            target_id=id
            $.ajax({
              url:`http://universeapi.net/review/list?movie_id=${id}`,
              data:{},
              type:"GET",
              success:function(json){
                console.log(json.data);
                console.log(json)
                console.log(id)
                $(".modal-body").html('')
                
                let reviews=json.data
                for(let i=0;i<reviews.length;i++){
                  $(".modal-body").append(`<p>${reviews[i].review}</p>`)
                }

              }
            })

            const myModal = new bootstrap.Modal(document.getElementById("review-modal"), 'show')
            myModal.show()
        }

          function addReview(){
            let review=$("#review").val();
            let review_html=`<p>${review}</p>`

            $("#review").val("");  //성공
          
            $.ajax({
              url:`http://universeapi.net/review/add`,
              data:{
                review_id:target_id, 
                review:review_html  //작동되지않는 코드,수정한코드
                                    //review <<본래 코드
              },
              type:"POST",
              success:function(json){
                console.log(json)
              }
            })

        
  
            $(".modal-body").append(review_html)
        
          }
        </script>
      </div>

</body>
</html>